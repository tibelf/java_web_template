package com.jd.jdda_collector.service;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import javax.annotation.Resource;

/**
 * Created with IntelliJ IDEA.
 * User: tibelf
 * Date: 14-9-15
 * Time: 下午6:09
 * To change this template use File | Settings | File Templates.
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = {"classpath:spring/root-context.xml"})
public class SqlTraceCollectorServiceImplTest {
    @Resource
    private SqlTraceCollectorServiceImpl sqlTraceCollectorService;

    @Before
    public void setUp() throws Exception {

    }

    @After
    public void tearDown() throws Exception {

    }

    @Test
    public void testParserAndSave() throws Exception {
        sqlTraceCollectorService.parserAndSave("[[[\"Controller/products/index\",\"/products\",475404811,\"SHOW FULL FIELDS FROM `products`\",\"Database/SQL/show\"," +
                "1,2.1,2,2,{\"backtrace\": \"/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/active_record.rb:70:in `block in log_with_newrelic_instrumentation'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/method_tracer.rb:219:in `trace_execution_scoped'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/active_record.rb:60:in `log_with_newrelic_instrumentation'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/connection_adapters/abstract_mysql_adapter.rb:245:in `execute'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/connection_adapters/mysql2_adapter.rb:211:in `execute'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/connection_adapters/abstract_mysql_adapter.rb:259:in `execute_and_free'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/connection_adapters/abstract_mysql_adapter.rb:426:in `columns'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/connection_adapters/schema_cache.rb:12:in `block in initialize'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/model_schema.rb:228:in `yield'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/model_schema.rb:228:in `default'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/model_schema.rb:228:in `columns'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/model_schema.rb:237:in `columns_hash'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/locking/optimistic.rb:129:in `locking_enabled?'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/relation.rb:170:in `exec_queries'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/relation.rb:160:in `block in to_a'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/explain.rb:33:in `logging_query_plan'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/relation.rb:159:in `to_a'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/relation/finder_methods.rb:159:in `all'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/querying.rb:5:in `all'\\n/home/tibelf/Rails/ppqq/app/controllers/products_controller.rb:5:in `index'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_controller/metal/implicit_render.rb:4:in `send_action'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/abstract_controller/base.rb:167:in `process_action'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_controller/metal/rendering.rb:10:in `process_action'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/abstract_controller/callbacks.rb:18:in `block in process_action'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/callbacks.rb:414:in `_run__2224577119958416680__process_action__2462166152339911251__callbacks'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/callbacks.rb:405:in `__run_callback'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/callbacks.rb:385:in `_run_process_action_callbacks'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/callbacks.rb:81:in `run_callbacks'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/abstract_controller/callbacks.rb:17:in `process_action'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_controller/metal/rescue.rb:29:in `process_action'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_controller/metal/instrumentation.rb:30:in `block in process_action'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/notifications.rb:123:in `block in instrument'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/notifications/instrumenter.rb:20:in `instrument'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/notifications.rb:123:in `instrument'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_controller/metal/instrumentation.rb:29:in `process_action'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_controller/metal/params_wrapper.rb:207:in `process_action'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/railties/controller_runtime.rb:18:in `process_action'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:32:in `block in process_action'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/controller_instrumentation.rb:365:in `perform_action_with_newrelic_trace'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/rails3/action_controller.rb:31:in `process_action'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/abstract_controller/base.rb:121:in `process'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/abstract_controller/rendering.rb:45:in `process'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_controller/metal.rb:203:in `dispatch'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_controller/metal/rack_delegation.rb:14:in `dispatch'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_controller/metal.rb:246:in `block in action'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/routing/route_set.rb:73:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/routing/route_set.rb:73:in `dispatch'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/routing/route_set.rb:36:in `call'\\n/var/lib/gems/1.9.1/gems/journey-1.0.4/lib/journey/router.rb:68:in `block in call'\\n/var/lib/gems/1.9.1/gems/journey-1.0.4/lib/journey/router.rb:56:in `each'\\n/var/lib/gems/1.9.1/gems/journey-1.0.4/lib/journey/router.rb:56:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/routing/route_set.rb:601:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/rack/error_collector.rb:50:in `traced_call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:55:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/rack/agent_hooks.rb:26:in `traced_call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:55:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/rack/browser_monitoring.rb:23:in `traced_call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:55:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/rack/developer_mode.rb:48:in `traced_call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:55:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/best_standards_support.rb:17:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/rack-1.4.5/lib/rack/etag.rb:23:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/rack-1.4.5/lib/rack/conditionalget.rb:25:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/head.rb:14:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/params_parser.rb:21:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/flash.rb:242:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/rack-1.4.5/lib/rack/session/abstract/id.rb:210:in `context'\\n/var/lib/gems/1.9.1/gems/rack-1.4.5/lib/rack/session/abstract/id.rb:205:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/cookies.rb:341:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/query_cache.rb:64:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/activerecord-3.2.11/lib/active_record/connection_adapters/abstract/connection_pool.rb:479:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/callbacks.rb:28:in `block in call'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/callbacks.rb:405:in `_run__2814801526970450893__call__1713929836448809022__callbacks'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/callbacks.rb:405:in `__run_callback'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/callbacks.rb:385:in `_run_call_callbacks'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/callbacks.rb:81:in `run_callbacks'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/callbacks.rb:27:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/reloader.rb:65:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/remote_ip.rb:31:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/debug_exceptions.rb:16:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/show_exceptions.rb:56:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/railties-3.2.11/lib/rails/rack/logger.rb:32:in `call_app'\\n/var/lib/gems/1.9.1/gems/railties-3.2.11/lib/rails/rack/logger.rb:16:in `block in call'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/tagged_logging.rb:22:in `tagged'\\n/var/lib/gems/1.9.1/gems/railties-3.2.11/lib/rails/rack/logger.rb:16:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/request_id.rb:22:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/rack-1.4.5/lib/rack/methodoverride.rb:21:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/rack-1.4.5/lib/rack/runtime.rb:17:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/activesupport-3.2.11/lib/active_support/cache/strategy/local_cache.rb:72:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/rack-1.4.5/lib/rack/lock.rb:15:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/actionpack-3.2.11/lib/action_dispatch/middleware/static.rb:62:in `call'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/railties-3.2.11/lib/rails/engine.rb:479:in `call'\\n/var/lib/gems/1.9.1/gems/railties-3.2.11/lib/rails/application.rb:223:in `call'\\n/var/lib/gems/1.9.1/gems/railties-3.2.11/lib/rails/railtie/configurable.rb:30:in `method_missing'\\n/home/tibelf/Newrelic/rpm-3.9.3.241/lib/new_relic/agent/instrumentation/middleware_tracing.rb:57:in `call'\\n/var/lib/gems/1.9.1/gems/rack-1.4.5/lib/rack/content_length.rb:14:in `call'\\n/var/lib/gems/1.9.1/gems/railties-3.2.11/lib/rails/rack/log_tailer.rb:17:in `call'\\n/var/lib/gems/1.9.1/gems/rack-1.4.5/lib/rack/handler/webrick.rb:59:in `service'\\n/usr/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'\\n/usr/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'\\n/usr/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'\"}" +
                "]]]", "1152815361");
    }
}
